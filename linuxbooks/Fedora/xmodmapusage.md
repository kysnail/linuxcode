## xmodmap 使用指南

### 1 什么是 xmodmap 
xmodmap 是一个在 X 图形环境下用于修改键盘和鼠标按钮映射的工具。比如你可以使用它来实现鼠标的左右键互换，把 caps lock 键改成 ctrl 键， a 键改成 b 键等。

在介绍 xmodmap 的使用方法之前，先介绍一下系统是如何处理键盘的输入的。


 * 键盘中的一个按键被按下时，会产生一个“信号”传给操作系统。  
 * 操作系统得到这个信号之后，检查此信号对应的处理方法。
 * 执行对应的处理方法。

上面的流程当中，键盘某键产生的信号是不可变的，就是我们后面会提到的 keycode 是不会变的。你按不同的键，实际上可以看成是传入了不同的 keycode ，至于这些 keycode 要做什么事那是后话。也就是说，你按下了键盘上的 a 键与是否输入了一个 a ，它们之间是没有必然联系的。同时，那些操作系统当中对不同信号设置的处理方法也是没法直接改变的。而唯一可以改变的，就是它们之间的映射关系。这也是 xmodmap 它要做的事。

第二步，操作系统得到键盘输入的信号之后，就去检查对应的处理方法。这个处理方法已经预置了一套，比如键盘的上 a 键产生的 keycode 对应的处理方法就是输入一个 a 。我们也可以根据自己的需求，把 a 产生的 keycode 让它对应到另外一个处理方法上去，比如输入的是一个 b 。

我们可以使用 xev 这个工具来获取不同按钮产生的 keycode ，比如 a 这个按钮产生的 keycode 是 28，tab 键产生的 keycode 是 23。

### 2 改变按键的行为
我们先看普通键的行为如何被更改。之前后再介绍修饰键，比如 ctrl 键的行为如何修改。

假如我们希望得到的一个效果是，按下 a 按键，但是却是输入一个 b。

根据前面的介绍，我们要做的事，只是把 a 按键对应的处理方法，改成和 b 按键的一样就可以了。

    xmodmap -e 'keycode 38 = b'

xmodmap 使用 -e 参数后面跟一个表达式来实现相应的修改。

keycode 的作用是将一个按键与一串处理方法绑定，是一串方法，不是一个，即：

    xmodmap -e 'keycode 38 = b E'

像这样一样，以空格分割，写多个处理方法。根据文档，你最多可以写8个处理方法，但是，一般只有前4个为可用的，第2个指定的是按住 shift 键时如何处理（第3个和第4个说的修饰键没接触过）。上面的代码的效果就是，直接按 a 键会输入一个 b ，按住 shift 键再按 a 键就是输入一个 E，大写的。

上面写的 b E 是两个处理方法，实际上，处理方法都是以整数表示的，在 xev 的输出中也可以看到， b 对应的是 0x62 ，而 E 对应的是 0x45 ，所以，上面的代码也可以写成：

    xmodmap -e 'keycode 38 = 0x62 0x45'

完整的处理方法数值列表，可以在 /usr/include/X11/keysymdef.h 这个文件中找到。

另外一种修改按键行为的方法是使用 keysym 来转换预定义的处理方法。比如把 0x62 这个处理方法转换成 0x63 ：

    xmodmap -e 'keysym 0x62 = 0x63'

这段代码与下面等价：

    xmodmap -e 'keysym b = c'

效果与下面的等价：

    xmodmap -e 'keycode 56 = c'

### 3 修改修饰键的行为
:;;



**Refs**

[xmodmap 使用指南](http://zouyesheng.com/xmodmap-usage.html)
