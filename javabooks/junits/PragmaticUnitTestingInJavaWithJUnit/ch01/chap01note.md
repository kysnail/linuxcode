## 第 1 章 序言 —— Introduction
`单元测试`：它是项目成功、个人成功的一个不可或缺的部分，但对它，人们却又存在各种各样的误解。单元测试其实是相对廉价而简单的技术，但它能让你更高效地写出质量更好的代码。

许多程序员觉得测试只是一件麻烦事：一种自找的烦恼，唯一的”效果“就是让他们设法专注于手上的正经事——`cutting code` （堆砌代码）。

单元测试的设计目的并不是为了获得一些更好的整体质量。也就是说，它并不是一个针对最终用户、项目经理和开发组长的工具；`而是由程序员自己来完成`，并且最终受益的也是程序员自己。我们是为了自身的利益去使用单元测试，从而让我们的工作变得更加轻松。

### 1.1 
对于每个新写的函数，在其他代码使用这个函数并对它形成依赖之前，都要先做单元测试。

### 1.2 
`单元测试` 是开发者编写的一小段代码，用于检验被测代码的一个很小的、很明确的功能是否正确。通常而言，一个单元测试是用于判断某个特定条件（或者场景）下某个特定函数的行为。

    执行单元测试，是为了证明某段代码的行为确实和开发者所期望的一致。

对于客户或最终使用者而言，这种测试必要吗，它与验收测试有关吗？这个问题仍然很难回答。事实上，我们在此并不关心整个产品的确认、验证和正确性等等；甚至此时，我们都不去关心性能方面的问题。我们所要做的一切就是要证明代码的行为和我们的期望一致。因此，我们所要测试的是规模很小的、非常独立的功能片段。通过对所有单独部分的行为建立起信息，确信它们都和我们的期望一致；然后，我们才能开始组装和测试整个系统。

毕竟，要是我们对手上正在写的代码的行为是否和我们的期望一致都没有把握，那么其他形式的测试也都只能是浪费时间而已。在单元测试之后，你还需要其他形式的测试，有可能是更正规的测试，那一切就都要看环境的需要来决定了。总之，做测试如同做善事，总是要从家开始。

### 1.3 
单元测试不但会使你的工作完成得更轻松，而且会令你的设计变得更好，甚至大大减少你花在调试上面的时间。

为了获得对代码的信心，你需要”询问“代码究竟做了什么，并检查所产生的结果是否确实和你所期望的一直。

这个简单的想法描述了单元测试的核心内涵：

    这个简单有效的技术就是为了令代码变得更加完美。

### 1.4
引入单元测试是很简单的，因为它本身就充满了乐趣。然而在项目交付的时候，我们给客户和最终用户的仍然是产品代码，而不包含单元测试的代码；因此，我们必须对单元测试的目的有充分的认识。首先也是最重要的，使用单元测试是为了是你的工作——以及你队友的工作——完成得更加轻松。

**■ **
最根本的，你想要回答下面这个问题：

    这段代码达到我的目的了吗？

也许就需求而言，代码所做的是错误的事情，但那是另外一个问题了。你要是代码向你证明它所做的就是你所期望的。

**■ **
许多开发者说他们只编写一个测试。也就是让所有代码从头到尾跑一次，只测试代码的一条正确执行路径，只要这样走一遍下来没有问题，测试也就算是完成了。

但是，现实生活当然不会这么事事顺心，事情也不总是那么美好。类似地，在测试某段代码的行为是否和你期望的一致时，你需要确认：

    在任何情况下，这段代码是否都和你的期望一致；譬如在风很大、参数很可疑、硬盘没有剩余空间、网络掉线的时候。

**■ **

    不能依赖的代码是没有多大用处的。

我们希望能够依赖于所编写的代码，并且清楚地知道这些代码的功能和约束。

**■ **
对于单元测试而言，一个最让人高兴的意外收获就是它能够帮助你充分理解代码的用法。从效果上而言，单元测试就像是能执行的文档，说明了你用各种条件调用代码时，你所能期望这段代码完成的功能。

项目成员能够通过查看单元测试来找到如何使用你所写代码的例子。如果他偶然发现了一个你没有考虑到的测试用例，那么他也可以很快地知道这个事实：

    你的代码可能并不支持这个用例。

显然，在正确性方面，可执行的文档有它的优势。与普通的文档不同的是，单元测试不会出现与代码不一致的情况（当然，除非你选择不运行这些测试）。


